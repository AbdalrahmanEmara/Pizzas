var Ie=Object.defineProperty;var de=t=>{throw TypeError(t)};var we=(t,e,s)=>e in t?Ie(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var fe=(t,e,s)=>we(t,typeof e!="symbol"?e+"":e,s),ee=(t,e,s)=>e.has(t)||de("Cannot "+s);var r=(t,e,s)=>(ee(t,e,"read from private field"),s?s.call(t):e.get(t)),x=(t,e,s)=>e.has(t)?de("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,s),d=(t,e,s,i)=>(ee(t,e,"write to private field"),i?i.call(t,s):e.set(t,s),s),m=(t,e,s)=>(ee(t,e,"access private method"),s);import{S as Te,p as pe,r as L,s as te,a as z,n as Qe,i as se,b as me,t as Pe,f as _e,c as De,d as be,e as je,g as j,u as Fe,h as Le,j as n,L as Ue,k as ke,l as Ce}from"./index-DI-WEO_K.js";import{s as Me,n as Ne}from"./utils-km2FGkQ4.js";var S,o,Y,O,$,K,M,F,Z,V,G,H,q,N,J,c,X,re,ie,ne,ae,oe,he,ce,Ee,Re,Be=(Re=class extends Te{constructor(e,s){super();x(this,c);x(this,S);x(this,o);x(this,Y);x(this,O);x(this,$);x(this,K);x(this,M);x(this,F);x(this,Z);x(this,V);x(this,G);x(this,H);x(this,q);x(this,N);x(this,J,new Set);this.options=s,d(this,S,e),d(this,F,null),d(this,M,pe()),this.options.experimental_prefetchInRender||r(this,M).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(s)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(r(this,o).addObserver(this),ye(r(this,o),this.options)?m(this,c,X).call(this):this.updateResult(),m(this,c,ae).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return le(r(this,o),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return le(r(this,o),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,m(this,c,oe).call(this),m(this,c,he).call(this),r(this,o).removeObserver(this)}setOptions(e,s){const i=this.options,l=r(this,o);if(this.options=r(this,S).defaultQueryOptions(e),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof L(this.options.enabled,r(this,o))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");m(this,c,ce).call(this),r(this,o).setOptions(this.options),i._defaulted&&!te(this.options,i)&&r(this,S).getQueryCache().notify({type:"observerOptionsUpdated",query:r(this,o),observer:this});const h=this.hasListeners();h&&ge(r(this,o),l,this.options,i)&&m(this,c,X).call(this),this.updateResult(s),h&&(r(this,o)!==l||L(this.options.enabled,r(this,o))!==L(i.enabled,r(this,o))||z(this.options.staleTime,r(this,o))!==z(i.staleTime,r(this,o)))&&m(this,c,re).call(this);const a=m(this,c,ie).call(this);h&&(r(this,o)!==l||L(this.options.enabled,r(this,o))!==L(i.enabled,r(this,o))||a!==r(this,N))&&m(this,c,ne).call(this,a)}getOptimisticResult(e){const s=r(this,S).getQueryCache().build(r(this,S),e),i=this.createResult(s,e);return $e(this,i)&&(d(this,O,i),d(this,K,this.options),d(this,$,r(this,o).state)),i}getCurrentResult(){return r(this,O)}trackResult(e,s){const i={};return Object.keys(e).forEach(l=>{Object.defineProperty(i,l,{configurable:!1,enumerable:!0,get:()=>(this.trackProp(l),s==null||s(l),e[l])})}),i}trackProp(e){r(this,J).add(e)}getCurrentQuery(){return r(this,o)}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){const s=r(this,S).defaultQueryOptions(e),i=r(this,S).getQueryCache().build(r(this,S),s);return i.fetch().then(()=>this.createResult(i,s))}fetch(e){return m(this,c,X).call(this,{...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),r(this,O)))}createResult(e,s){var k;const i=r(this,o),l=this.options,h=r(this,O),a=r(this,$),I=r(this,K),b=e!==i?e.state:r(this,Y),{state:C}=e;let u={...C},w=!1,y;if(s._optimisticResults){const p=this.hasListeners(),T=!p&&ye(e,s),R=p&&ge(e,i,s,l);(T||R)&&(u={...u,...De(C.data,e.options)}),s._optimisticResults==="isRestoring"&&(u.fetchStatus="idle")}let{error:Q,errorUpdatedAt:E,status:v}=u;if(s.select&&u.data!==void 0)if(h&&u.data===(a==null?void 0:a.data)&&s.select===r(this,Z))y=r(this,V);else try{d(this,Z,s.select),y=s.select(u.data),y=be(h==null?void 0:h.data,y,s),d(this,V,y),d(this,F,null)}catch(p){d(this,F,p)}else y=u.data;if(s.placeholderData!==void 0&&y===void 0&&v==="pending"){let p;if(h!=null&&h.isPlaceholderData&&s.placeholderData===(I==null?void 0:I.placeholderData))p=h.data;else if(p=typeof s.placeholderData=="function"?s.placeholderData((k=r(this,G))==null?void 0:k.state.data,r(this,G)):s.placeholderData,s.select&&p!==void 0)try{p=s.select(p),d(this,F,null)}catch(T){d(this,F,T)}p!==void 0&&(v="success",y=be(h==null?void 0:h.data,p,s),w=!0)}r(this,F)&&(Q=r(this,F),y=r(this,V),E=Date.now(),v="error");const B=u.fetchStatus==="fetching",P=v==="pending",_=v==="error",U=P&&B,W=y!==void 0,g={status:v,fetchStatus:u.fetchStatus,isPending:P,isSuccess:v==="success",isError:_,isInitialLoading:U,isLoading:U,data:y,dataUpdatedAt:u.dataUpdatedAt,error:Q,errorUpdatedAt:E,failureCount:u.fetchFailureCount,failureReason:u.fetchFailureReason,errorUpdateCount:u.errorUpdateCount,isFetched:u.dataUpdateCount>0||u.errorUpdateCount>0,isFetchedAfterMount:u.dataUpdateCount>b.dataUpdateCount||u.errorUpdateCount>b.errorUpdateCount,isFetching:B,isRefetching:B&&!P,isLoadingError:_&&!W,isPaused:u.fetchStatus==="paused",isPlaceholderData:w,isRefetchError:_&&W,isStale:ue(e,s),refetch:this.refetch,promise:r(this,M)};if(this.options.experimental_prefetchInRender){const p=D=>{g.status==="error"?D.reject(g.error):g.data!==void 0&&D.resolve(g.data)},T=()=>{const D=d(this,M,g.promise=pe());p(D)},R=r(this,M);switch(R.status){case"pending":e.queryHash===i.queryHash&&p(R);break;case"fulfilled":(g.status==="error"||g.data!==R.value)&&T();break;case"rejected":(g.status!=="error"||g.error!==R.reason)&&T();break}}return g}updateResult(e){const s=r(this,O),i=this.createResult(r(this,o),this.options);if(d(this,$,r(this,o).state),d(this,K,this.options),r(this,$).data!==void 0&&d(this,G,r(this,o)),te(i,s))return;d(this,O,i);const l={},h=()=>{if(!s)return!0;const{notifyOnChangeProps:a}=this.options,I=typeof a=="function"?a():a;if(I==="all"||!I&&!r(this,J).size)return!0;const f=new Set(I??r(this,J));return this.options.throwOnError&&f.add("error"),Object.keys(r(this,O)).some(b=>{const C=b;return r(this,O)[C]!==s[C]&&f.has(C)})};(e==null?void 0:e.listeners)!==!1&&h()&&(l.listeners=!0),m(this,c,Ee).call(this,{...l,...e})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&m(this,c,ae).call(this)}},S=new WeakMap,o=new WeakMap,Y=new WeakMap,O=new WeakMap,$=new WeakMap,K=new WeakMap,M=new WeakMap,F=new WeakMap,Z=new WeakMap,V=new WeakMap,G=new WeakMap,H=new WeakMap,q=new WeakMap,N=new WeakMap,J=new WeakMap,c=new WeakSet,X=function(e){m(this,c,ce).call(this);let s=r(this,o).fetch(this.options,e);return e!=null&&e.throwOnError||(s=s.catch(Qe)),s},re=function(){m(this,c,oe).call(this);const e=z(this.options.staleTime,r(this,o));if(se||r(this,O).isStale||!me(e))return;const i=Pe(r(this,O).dataUpdatedAt,e)+1;d(this,H,setTimeout(()=>{r(this,O).isStale||this.updateResult()},i))},ie=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(r(this,o)):this.options.refetchInterval)??!1},ne=function(e){m(this,c,he).call(this),d(this,N,e),!(se||L(this.options.enabled,r(this,o))===!1||!me(r(this,N))||r(this,N)===0)&&d(this,q,setInterval(()=>{(this.options.refetchIntervalInBackground||_e.isFocused())&&m(this,c,X).call(this)},r(this,N)))},ae=function(){m(this,c,re).call(this),m(this,c,ne).call(this,m(this,c,ie).call(this))},oe=function(){r(this,H)&&(clearTimeout(r(this,H)),d(this,H,void 0))},he=function(){r(this,q)&&(clearInterval(r(this,q)),d(this,q,void 0))},ce=function(){const e=r(this,S).getQueryCache().build(r(this,S),this.options);if(e===r(this,o))return;const s=r(this,o);d(this,o,e),d(this,Y,e.state),this.hasListeners()&&(s==null||s.removeObserver(this),e.addObserver(this))},Ee=function(e){je.batch(()=>{e.listeners&&this.listeners.forEach(s=>{s(r(this,O))}),r(this,S).getQueryCache().notify({query:r(this,o),type:"observerResultsUpdated"})})},Re);function Ae(t,e){return L(e.enabled,t)!==!1&&t.state.data===void 0&&!(t.state.status==="error"&&e.retryOnMount===!1)}function ye(t,e){return Ae(t,e)||t.state.data!==void 0&&le(t,e,e.refetchOnMount)}function le(t,e,s){if(L(e.enabled,t)!==!1){const i=typeof s=="function"?s(t):s;return i==="always"||i!==!1&&ue(t,e)}return!1}function ge(t,e,s,i){return(t!==e||L(i.enabled,t)===!1)&&(!s.suspense||t.state.status!=="error")&&ue(t,s)}function ue(t,e){return L(e.enabled,t)!==!1&&t.isStaleByTime(z(e.staleTime,t))}function $e(t,e){return!te(t.getCurrentResult(),e)}var Oe=j.createContext(!1),He=()=>j.useContext(Oe);Oe.Provider;function qe(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}var We=j.createContext(qe()),Ke=()=>j.useContext(We),Ve=(t,e)=>{(t.suspense||t.throwOnError)&&(e.isReset()||(t.retryOnMount=!1))},Ge=t=>{j.useEffect(()=>{t.clearReset()},[t])},Je=({result:t,errorResetBoundary:e,throwOnError:s,query:i})=>t.isError&&!e.isReset()&&!t.isFetching&&i&&Me(s,[t.error,i]),Xe=t=>{t.suspense&&(typeof t.staleTime!="number"&&(t.staleTime=1e3),typeof t.gcTime=="number"&&(t.gcTime=Math.max(t.gcTime,1e3)))},Ye=(t,e)=>t.isLoading&&t.isFetching&&!e,Ze=(t,e)=>(t==null?void 0:t.suspense)&&e.isPending,xe=(t,e,s)=>e.fetchOptimistic(t).catch(()=>{s.clearReset()});function ze(t,e,s){var C,u,w,y,Q;const i=Fe(),l=He(),h=Ke(),a=i.defaultQueryOptions(t);(u=(C=i.getDefaultOptions().queries)==null?void 0:C._experimental_beforeQuery)==null||u.call(C,a),a._optimisticResults=l?"isRestoring":"optimistic",Xe(a),Ve(a,h),Ge(h);const I=!i.getQueryCache().get(a.queryHash),[f]=j.useState(()=>new e(i,a)),b=f.getOptimisticResult(a);if(j.useSyncExternalStore(j.useCallback(E=>{const v=l?()=>{}:f.subscribe(je.batchCalls(E));return f.updateResult(),v},[f,l]),()=>f.getCurrentResult(),()=>f.getCurrentResult()),j.useEffect(()=>{f.setOptions(a,{listeners:!1})},[a,f]),Ze(a,b))throw xe(a,f,h);if(Je({result:b,errorResetBoundary:h,throwOnError:a.throwOnError,query:i.getQueryCache().get(a.queryHash)}))throw b.error;if((y=(w=i.getDefaultOptions().queries)==null?void 0:w._experimental_afterQuery)==null||y.call(w,a,b),a.experimental_prefetchInRender&&!se&&Ye(b,l)){const E=I?xe(a,f,h):(Q=i.getQueryCache().get(a.queryHash))==null?void 0:Q.promise;E==null||E.catch(Ne).finally(()=>{f.hasListeners()||f.updateResult()})}return a.notifyOnChangeProps?b:f.trackResult(b)}function Se(t,e){return ze(t,Be)}async function et(t){return await(await fetch(`/api/past-orders?page=${t}`)).json()}async function tt(t){return(await fetch(`/api/past-order/${t}`)).json()}const st=({children:t})=>{const e=j.useRef(null);return e.current||(e.current=document.createElement("div")),j.useEffect(()=>{const s=document.getElementById("modal");return s.appendChild(e.current),()=>s.removeChild(e.current)},[]),Le.createPortal(n.jsx("div",{children:t}),e.current)},rt=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}),ve=t=>rt.format(t);class it extends j.Component{constructor(){super(...arguments);fe(this,"state",{hasError:!1})}static getDerivedStateFromError(){return{hasError:!0}}componentDidCatch(s,i){console.error("ErrorBoundary caught an error",s,i)}render(){return this.state.hasError?n.jsxs("div",{className:"error-boundary",children:[n.jsx("h2",{children:"Uh oh!"}),n.jsxs("p",{children:["There was an error with this listing.",n.jsx(Ue,{to:"/",children:"Click here"})," to back to the home page."]})]}):this.props.children}}const ut=ke("/past")({component:nt});function nt(){const t=Ce.c(6),[e,s]=j.useState(1);let i;t[0]!==e?(i={queryKey:["past-orders",e],queryFn:()=>et(e),staleTime:3e4},t[0]=e,t[1]=i):i=t[1];const l=Se(i).promise;let h;t[2]===Symbol.for("react.memo_cache_sentinel")?(h=n.jsx("div",{className:"past-orders",children:n.jsx("h2",{children:"Loading Past Orders ..."})}),t[2]=h):h=t[2];let a;return t[3]!==l||t[4]!==e?(a=n.jsx(it,{children:n.jsx(j.Suspense,{fallback:h,children:n.jsx(at,{loadedPromise:l,page:e,setPage:s})})}),t[3]=l,t[4]=e,t[5]=a):a=t[5],a}function at(t){const e=Ce.c(40),{loadedPromise:s,page:i,setPage:l}=t,h=j.use(s),[a,I]=j.useState();let f,b;e[0]!==a?(f=["past-order",a],b=()=>tt(a),e[0]=a,e[1]=f,e[2]=b):(f=e[1],b=e[2]);const C=!!a;let u;e[3]!==f||e[4]!==b||e[5]!==C?(u={queryKey:f,queryFn:b,enabled:C,staleTime:864e5},e[3]=f,e[4]=b,e[5]=C,e[6]=u):u=e[6];const{isLoading:w,data:y}=Se(u);if(h.isLoading){let R;return e[7]===Symbol.for("react.memo_cache_sentinel")?(R=n.jsx("div",{className:"past-orders",children:n.jsx("h2",{children:"LOADING ..."})}),e[7]=R):R=e[7],R}let Q;e[8]===Symbol.for("react.memo_cache_sentinel")?(Q=n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("td",{children:"ID"}),n.jsx("td",{children:"Date"}),n.jsx("td",{children:"Time"})]})}),e[8]=Q):Q=e[8];let E;if(e[9]!==h){let R;e[11]===Symbol.for("react.memo_cache_sentinel")?(R=D=>n.jsxs("tr",{children:[n.jsx("td",{children:n.jsx("button",{onClick:()=>I(D.order_id),children:D.order_id})}),n.jsx("td",{children:D.date}),n.jsx("td",{children:D.time})]},D.order_id),e[11]=R):R=e[11],E=h.map(R),e[9]=h,e[10]=E}else E=e[10];let v;e[12]!==E?(v=n.jsxs("table",{children:[Q,n.jsx("tbody",{children:E})]}),e[12]=E,e[13]=v):v=e[13];const B=i<=1;let P;e[14]!==i||e[15]!==l?(P=()=>l(i-1),e[14]=i,e[15]=l,e[16]=P):P=e[16];let _;e[17]!==B||e[18]!==P?(_=n.jsx("button",{disabled:B,onClick:P,children:"Previous"}),e[17]=B,e[18]=P,e[19]=_):_=e[19];let U;e[20]!==i?(U=n.jsx("div",{children:i}),e[20]=i,e[21]=U):U=e[21];const W=h.length<10;let A;e[22]!==i||e[23]!==l?(A=()=>l(i+1),e[22]=i,e[23]=l,e[24]=A):A=e[24];let g;e[25]!==W||e[26]!==A?(g=n.jsx("button",{disabled:W,onClick:A,children:"Next"}),e[25]=W,e[26]=A,e[27]=g):g=e[27];let k;e[28]!==_||e[29]!==U||e[30]!==g?(k=n.jsxs("div",{className:"pages",children:[_,U,g]}),e[28]=_,e[29]=U,e[30]=g,e[31]=k):k=e[31];let p;e[32]!==a||e[33]!==w||e[34]!==y?(p=a?n.jsxs(st,{children:[n.jsxs("h2",{children:["Order #",a]}),w?n.jsx("p",{children:"Loading ..."}):n.jsxs("table",{children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("td",{children:"Image"}),n.jsx("td",{children:"Name"}),n.jsx("td",{children:"Size"}),n.jsx("td",{children:"Quantity"}),n.jsx("td",{children:"Price"}),n.jsx("td",{children:"Total"})]})}),n.jsx("tbody",{children:y.orderItems.map(ot)})]}),n.jsx("button",{onClick:()=>I(),children:"Close"})]}):null,e[32]=a,e[33]=w,e[34]=y,e[35]=p):p=e[35];let T;return e[36]!==k||e[37]!==p||e[38]!==v?(T=n.jsxs("div",{className:"past-orders",children:[v,k,p]}),e[36]=k,e[37]=p,e[38]=v,e[39]=T):T=e[39],T}function ot(t){return n.jsxs("tr",{children:[n.jsx("td",{children:n.jsx("img",{src:t.image,alt:t.name})}),n.jsx("td",{children:t.name}),n.jsx("td",{children:t.size}),n.jsx("td",{children:t.quantity}),n.jsx("td",{children:ve(t.price)}),n.jsx("td",{children:ve(t.total)})]},`${t.pizzaTypeId}_${t.size}`)}export{ut as Route};
